### Dev version ###

- Dev odoo without `CMD [ "odoo" ]` and `entrypoint.sh`: 
  - "odoo -d db --db_host db --db_port 5432 --db_user odoo --db_password odoo --dev=all,ipdb --xmlrpc-port=8069"
  - "docker exec -it n bash"

- Dev odoo with log file: "odoo --db_host db --db_port 5432 --db_user odoo --db_password odoo --xmlrpc-port=8069 --logfile=/var/log/odoo/odoo_inst1.log"

- Test: "odoo -d db -u todo_app --test-enable --log-level=test --db_host db --db_port 5432 --db_user odoo --db_password odoo --xmlrpc-port=8069 --stop-after-init"

- Run: 
  - "odoo --db_host db --db_port 5432 --db_user odoo --db_password odoo --xmlrpc-port=8069 --log-level=info"

### Official Distribute ###

- multi odoo instance: "odoo --db_host db --db_port 5432 --db_user odoo --db_password odoo --xmlrpc-port=8070 --logfile=/var/log/odoo/odoo_inst1.log"

- print command used to run `odoo-bin`: *ps -aux | awk '{ s = ""; for (i = 11; i <= 30; i++) s = s $i " "; print s }'*

- with updates (`todo_app` i'm developing): "odoo --db_host db --db_port 5432 --db_user odoo --db_password odoo --xmlrpc-port=8070 --logfile=/var/log/odoo/odoo_inst1.log -u todo_app"

  - note: `-u` command can follow comma separated module names
    `todo_app,mail ...`
  
- enable test: "odoo --db_host db --db_port 5432 -r odoo -w odoo -i todo_app --test-enable --xmlrpc-port=8070 --logfile=/var/log/odoo/odoo_inst1.log"
  
- enable test: "odoo --test-enable -i todo_app --log-level=test --db_host db --db_port 5432 --db_user odoo --db_password odoo --xmlrpc-port=8070 --logfile=stdout --stop-after-init"

## Docker ##

### Backup & Restore ###

Must change owner & group after restored.
Odoo volume is odoo & odoo
  drwxr-xr-x 5 odoo odoo 4096 Oct 17 10:03 odoo
pgdb volume is postgres & postgres
  drwxrwxrwx 3 postgres postgres 4096 Oct 17 10:00 data
  in ./data:
    drwx------ 18 postgres root     4096 Oct 17 10:01 pgdata

#### Backup ####

```bash
docker run --rm \ 
  --volume [DOCKER_COMPOSE_PREFIX]_[VOLUME_NAME]:/[TEMPORARY_DIRECTORY_TO_STORE_VOLUME_DATA] \
  --volume $(pwd):/[TEMPORARY_DIRECTORY_TO_STORE_BACKUP_FILE] \
  ubuntu \
  tar cvf /[TEMPORARY_DIRECTORY_TO_STORE_BACKUP_FILE]/[BACKUP_FILENAME].tar /[TEMPORARY_DIRECTORY_TO_STORE_VOLUME_DATA]
```

```bash
#~$(pwd)/backup~ dir on host
#~/backup~ dir in container
#template used:
docker run --rm \
  --volume [named_volume_name]:/volume_data \
  --volume $(pwd)/backup:/backup \
  ubuntu \
  tar cvf /backup/[named_volume_name]_backup.tar /volume_data

docker run --rm \
  --volume docker_odoo_odoo-web-data:/volume_data \
  --volume $(pwd)/backup:/backup \
  ubuntu \
  tar cvf /backup/docker_odoo_odoo-web-data_backup.tar /volume_data

docker run --rm \
  --volume docker_odoo_odoo-db-data:/volume_data \
  --volume $(pwd)/backup:/backup \
  ubuntu \
  tar cvf /backup/docker_odoo_odoo-db-data_backup.tar /volume_data

```

#### Restore ####

```bash
docker run --rm \ 
  --volume [DOCKER_COMPOSE_PREFIX]_[VOLUME_NAME]:/[TEMPORARY_DIRECTORY_STORING_EXTRACTED_BACKUP] \
  --volume $(pwd):/[TEMPORARY_DIRECTORY_TO_STORE_BACKUP_FILE] \
  ubuntu \
  tar xvf /[TEMPORARY_DIRECTORY_TO_STORE_BACKUP_FILE]/[BACKUP_FILENAME].tar -C /[TEMPORARY_DIRECTORY_STORING_EXTRACTED_BACKUP] --strip 1
```

```bash
#Correct permissions
#Direct outputs to parent dir
docker run --rm \
  --volume docker_odoo_odoo-web-data:/volume_data \
  --volume $(pwd)/backup:/backup \
  ubuntu \
  tar xvf /backup/docker_odoo_odoo-web-data_backup.tar -C /

docker run --rm \
  --volume docker_odoo_odoo-db-data:/volume_data \
  --volume $(pwd)/backup:/backup \
  ubuntu \
  tar xvf /backup/docker_odoo_odoo-db-data_backup.tar -C /
```



```bash
#Incorrect usage: strip 1 will use /volume_data dir generated by
#temp container's root user, has incorrect permissions.
#Omit strip 1 option and output to parent dir (`/`) instead

#template used:
docker run --rm \ 
  --volume [named_volume_name]:/volume_data \
  --volume $(pwd):/backup \
  ubuntu \
  tar xvf /backup/[named_volume_name]_backup.tar -C /volume_data --strip 1

docker run --rm \
  --volume docker_odoo_odoo-web-data:/volume_data \
  --volume $(pwd)/backup:/backup \
  ubuntu \
  tar xvf /backup/docker_odoo_odoo-web-data_backup.tar -C /volume_data --strip 1

docker run --rm \
  --volume docker_odoo_odoo-db-data:/volume_data \
  --volume $(pwd)/backup:/backup \
  ubuntu \
  tar xvf /backup/docker_odoo_odoo-db-data_backup.tar -C /volume_data --strip 1
```

#### check restored volumes rights ####

##### with strip 1 option, incorrect permissions #####

  original
  drwxr-xr-x 5 odoo odoo 4096 Oct 18 10:29 .
  drwxr-xr-x 1 root root 4096 Jun 20  2017 ..
  drwx------ 3 odoo odoo 4096 Oct 18 10:28 addons
  lrwxrwxrwx 1 odoo odoo    9 Oct 18 10:28 config_odoo -> /etc/odoo
  lrwxrwxrwx 1 odoo odoo   17 Oct 18 10:28 extra-addons -> /mnt/extra-addons
  drwxr-xr-x 3 odoo odoo 4096 Oct 18 10:29 filestore
  lrwxrwxrwx 1 odoo odoo   43 Oct 18 10:28 pos_src -> /var/lib/odoo/src_odoo/addons/point_of_sale
  lrwxrwxrwx 1 odoo odoo   57 Oct 18 10:28 pos_src_js -> /var/lib/odoo/src_odoo/addons/point_of_sale/static/src/js
  drwx------ 2 odoo odoo 4096 Oct 18 10:43 sessions
  lrwxrwxrwx 1 odoo odoo   37 Oct 18 10:28 src_odoo -> /usr/lib/python2.7/dist-packages/odoo

  backup
  drwxr-xr-x 5 root root 4096 Oct 18 10:49 .
  drwxr-xr-x 1 root root 4096 Oct 18 10:49 ..
  drwx------ 3  104  107 4096 Oct 18 10:28 addons
  lrwxrwxrwx 1  104  107    9 Oct 18 10:28 config_odoo -> /etc/odoo
  lrwxrwxrwx 1  104  107   17 Oct 18 10:28 extra-addons -> /mnt/extra-addons
  drwxr-xr-x 3  104  107 4096 Oct 18 10:29 filestore
  lrwxrwxrwx 1  104  107   43 Oct 18 10:28 pos_src -> /var/lib/odoo/src_odoo/addons/point_of_sale
  lrwxrwxrwx 1  104  107   57 Oct 18 10:28 pos_src_js -> /var/lib/odoo/src_odoo/addons/point_of_sale/static/src/js
  drwx------ 2  104  107 4096 Oct 18 10:43 sessions
  lrwxrwxrwx 1  104  107   37 Oct 18 10:28 src_odoo -> /usr/lib/python2.7/dist-packages/odoo


  original
  drwx------ 18 postgres root     4096 Oct 18 10:28 pgdata
  backup
  drwx------ 18  999 root 4096 Oct 18 10:28 pgdata

  original
  drwx------ 18 postgres root      4096 Oct 18 10:28 .
  drwxrwxrwx  3 postgres postgres  4096 Oct 18 10:28 ..
  drwx------  7 postgres postgres  4096 Oct 18 10:29 base
  drwx------  2 postgres postgres  4096 Oct 18 10:38 global
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_clog
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_dynshmem
  -rw-------  1 postgres postgres  4490 Oct 18 10:28 pg_hba.conf
  -rw-------  1 postgres postgres  1636 Oct 18 10:28 pg_ident.conf
  drwx------  4 postgres postgres  4096 Oct 18 10:28 pg_logical
  drwx------  4 postgres postgres  4096 Oct 18 10:28 pg_multixact
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_notify
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_replslot
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_serial
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_snapshots
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_stat
  drwx------  2 postgres postgres  4096 Oct 18 10:53 pg_stat_tmp
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_subtrans
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_tblspc
  drwx------  2 postgres postgres  4096 Oct 18 10:28 pg_twophase
  -rw-------  1 postgres postgres     4 Oct 18 10:28 PG_VERSION
  drwx------  3 postgres postgres  4096 Oct 18 10:44 pg_xlog
  -rw-------  1 postgres postgres    88 Oct 18 10:28 postgresql.auto.conf
  -rw-------  1 postgres postgres 20791 Oct 18 10:28 postgresql.conf
  -rw-------  1 postgres postgres    37 Oct 18 10:28 postmaster.opts
  -rw-------  1 postgres postgres    92 Oct 18 10:28 postmaster.pid

  backup
  drwx------ 18  999 root  4096 Oct 18 10:28 .
  drwxr-xr-x  3 root root  4096 Oct 18 10:47 ..
  -rw-------  1  999  999     4 Oct 18 10:28 PG_VERSION
  drwx------  7  999  999  4096 Oct 18 10:29 base
  drwx------  2  999  999  4096 Oct 18 10:38 global
  drwx------  2  999  999  4096 Oct 18 10:28 pg_clog
  drwx------  2  999  999  4096 Oct 18 10:28 pg_dynshmem
  -rw-------  1  999  999  4490 Oct 18 10:28 pg_hba.conf
  -rw-------  1  999  999  1636 Oct 18 10:28 pg_ident.conf
  drwx------  4  999  999  4096 Oct 18 10:28 pg_logical
  drwx------  4  999  999  4096 Oct 18 10:28 pg_multixact
  drwx------  2  999  999  4096 Oct 18 10:28 pg_notify
  drwx------  2  999  999  4096 Oct 18 10:28 pg_replslot
  drwx------  2  999  999  4096 Oct 18 10:28 pg_serial
  drwx------  2  999  999  4096 Oct 18 10:28 pg_snapshots
  drwx------  2  999  999  4096 Oct 18 10:28 pg_stat
  drwx------  2  999  999  4096 Oct 18 10:44 pg_stat_tmp
  drwx------  2  999  999  4096 Oct 18 10:28 pg_subtrans
  drwx------  2  999  999  4096 Oct 18 10:28 pg_tblspc
  drwx------  2  999  999  4096 Oct 18 10:28 pg_twophase
  drwx------  3  999  999  4096 Oct 18 10:41 pg_xlog
  -rw-------  1  999  999    88 Oct 18 10:28 postgresql.auto.conf
  -rw-------  1  999  999 20791 Oct 18 10:28 postgresql.conf
  -rw-------  1  999  999    37 Oct 18 10:28 postmaster.opts
  -rw-------  1  999  999    92 Oct 18 10:28 postmaster.pid
### Remove Volumes ###
- "docker volume rm `docker volume ls -q -f dangling=true`"

